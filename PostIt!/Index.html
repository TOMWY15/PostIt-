<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PostIt! ‚Äî Single HTML with UP/IN switch</title>
<style>
  :root{
    --bg:#071021; --card:#0b1220; --muted:#9aa6bf; --accent:#1d9bf0; --accent-2:#f91880;
    --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,#041022 0%, #071021 60%); color:#eaf0ff;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  /* layout */
  .center-wrap{max-width:980px;margin:28px auto;padding:18px;display:flex;gap:14px;}
  .card{background:var(--card);border-radius:12px;padding:14px;border:1px solid var(--glass);box-shadow:0 6px 18px rgba(2,6,23,0.6)}
  .auth-card{max-width:420px;margin:40px auto;padding:20px;text-align:center}
  h1{margin:0 0 8px;font-size:20px;color:var(--accent)}
  .small{font-size:13px;color:var(--muted);margin-top:6px}

  /* switch UP/IN */
  .switch-wrap{display:flex;flex-direction:column;align-items:center;gap:8px;margin-bottom:12px}
  .word-switch{position:relative;overflow:hidden;height:36px;width:120px}
  .word-switch span{position:absolute;left:0;right:0;text-align:center;font-weight:800;font-size:28px;line-height:36px;transition:transform .36s cubic-bezier(.2,.9,.2,1)}
  .word-switch .up{transform:translateY(0)}
  .word-switch .in{transform:translateY(100%)}
  .word-switch.switch .up{transform:translateY(-100%)}
  .word-switch.switch .in{transform:translateY(0)}
  .switch-btn{padding:8px 14px;border-radius:999px;border:none;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;transition:transform .18s}
  .switch-btn:active{transform:scale(.98)}

  /* forms */
  input,textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#eaf0ff;margin-top:8px;font-size:14px}
  textarea{resize:vertical}
  .btn{display:inline-block;padding:8px 14px;border-radius:999px;border:none;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;margin-top:10px}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
  .muted{color:var(--muted);font-size:13px}

  /* app layout */
  .app-wrap{display:flex;gap:12px}
  .sidebar{width:220px;display:flex;flex-direction:column;gap:8px}
  .nav-item{padding:10px;border-radius:8px;color:var(--muted);cursor:pointer}
  .nav-item.active{background:linear-gradient(90deg, rgba(29,155,240,0.08), rgba(249,24,128,0.03));color:var(--accent);font-weight:700}
  .main{flex:1}
  .tabs{min-height:320px}
  .tab{opacity:0;transform:translateY(10px);transition:all .36s cubic-bezier(.2,.9,.2,1);display:none}
  .tab.active{display:block;opacity:1;transform:translateY(0)}

  /* posts */
  .post{border-top:1px solid rgba(255,255,255,0.04);padding-top:10px;margin-top:10px}
  .post .meta{font-size:13px;color:var(--muted)}
  .post-media img, .post-media video{max-width:100%;border-radius:10px;margin-top:8px}
  .controls{display:flex;gap:8px;align-items:center;margin-top:8px}
  .like{background:transparent;border:none;color:var(--accent-2);cursor:pointer;font-weight:700}
  .share{background:transparent;border:none;color:gold;cursor:pointer}

  /* small responsive */
  @media(max-width:880px){
    .center-wrap{flex-direction:column;padding:12px}
    .sidebar{width:100%;flex-direction:row;flex-wrap:wrap}
    .nav-item{flex:1;text-align:center}
  }
</style>
</head>
<body>

<!-- AUTH VIEW -->
<div id="auth_view" class="auth-card card" aria-live="polite">
  <div class="switch-wrap">
    <!-- switch above, shows IN or UP visually -->
    <div class="word-switch" id="switcher" aria-hidden="true">
      <span class="up">UP</span>
      <span class="in">IN</span>
    </div>

    <!-- button shows "Log IN" or "Log UP" depending on mode -->
    <button id="modeBtn" class="switch-btn" type="button" aria-pressed="false">Log <strong id="mode_text">IN</strong></button>
  </div>

  <h1 id="auth_title">Accedi al tuo account</h1>

  <!-- login fields -->
  <div id="login_form">
    <input id="login_user" placeholder="Username" autocomplete="username" />
    <input id="login_pass" type="password" placeholder="Password" autocomplete="current-password" />
    <div style="display:flex;gap:8px;justify-content:center">
      <button class="btn" onclick="doLogin()">Login</button>
      <button class="btn ghost" onclick="switchTo('signup')">Vai a Sign UP</button>
    </div>
  </div>

  <!-- signup fields (hidden by default) -->
  <div id="signup_form" style="display:none;margin-top:8px">
    <input id="signup_user" placeholder="Nuovo username" autocomplete="username" />
    <input id="signup_pass" type="password" placeholder="Nuova password" autocomplete="new-password" />
    <div style="display:flex;gap:8px;justify-content:center">
      <button class="btn" onclick="doSignup()">Crea account</button>
      <button class="btn ghost" onclick="switchTo('login')">Vai a Log IN</button>
    </div>
  </div>

  <div class="small muted" style="margin-top:12px">
    Oppure entra come <button class="btn ghost" onclick="guestLogin()" style="display:inline-block;padding:6px 10px">Guest</button>
  </div>
</div>

<!-- APP (hidden until login) -->
<div id="app" class="card" style="max-width:980px;margin:18px auto;display:none">
  <div class="center-wrap app-wrap">
    <aside class="sidebar card" style="padding:12px">
      <div id="nav_home" class="nav-item active" onclick="switchTab('home', this)">üè† Home</div>
      <div id="nav_posts" class="nav-item" onclick="switchTab('posts', this)">üìù Post</div>
      <div id="nav_profile" class="nav-item" onclick="switchTab('profile', this)">üë§ Profilo</div>
      <div id="nav_settings" class="nav-item" onclick="switchTab('settings', this)">‚öôÔ∏è Impostazioni</div>
      <div class="nav-item" onclick="doLogout()">üö™ Logout</div>
    </aside>

    <main class="main">
      <div class="tabs">
        <!-- HOME -->
        <section id="tab_home" class="tab active">
          <h2>Feed</h2>
          <div id="feed"></div>
        </section>

        <!-- POSTS -->
        <section id="tab_posts" class="tab">
          <h2>Crea Post</h2>
          <textarea id="post_text" rows="3" placeholder="Cosa succede?"></textarea>
          <input id="post_media_url" placeholder="Media URL (opzionale)" />
          <input id="post_media_file" type="file" accept="image/*,video/*" />
          <div style="display:flex;gap:8px">
            <button class="btn" onclick="createPost()">Pubblica</button>
            <button class="btn ghost" onclick="renderMyPosts()">I miei post</button>
          </div>
          <div id="my_posts" style="margin-top:12px"></div>
        </section>

        <!-- PROFILE -->
        <section id="tab_profile" class="tab">
          <h2>Profilo</h2>
          <div class="muted">Utente: <strong id="profile_name"></strong></div>
          <div style="margin-top:8px">
            <textarea id="profile_desc_input" rows="2" placeholder="Breve descrizione"></textarea>
            <input id="profile_avatar_url" placeholder="Avatar URL (opzionale)" />
            <input id="profile_avatar_file" type="file" accept="image/*" />
            <div style="display:flex;gap:8px">
              <button class="btn" onclick="saveProfile()">Salva profilo</button>
              <button class="btn ghost" onclick="renderProfile()">Mostra profilo</button>
            </div>
          </div>
        </section>

        <!-- SETTINGS -->
        <section id="tab_settings" class="tab">
          <h2>Impostazioni</h2>
          <div class="muted">Tema (demo)</div>
          <select id="theme_select" onchange="applyTheme(this.value)">
            <option value="dark">Scuro</option>
            <option value="light">Chiaro</option>
          </select>
        </section>
      </div>
    </main>
  </div>
</div>

<script>
/* -------------------------
   Minimal local "DB"
   ------------------------- */
const STORAGE_KEY = "postit_single_html_v1";
let state = { users: {}, posts: [], currentUser: null };

/* load/save */
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) state = JSON.parse(raw);
  }catch(e){ console.warn("load error", e) }
}
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

/* boot */
loadState();

/* -------------------------
   Mode switch (UP/IN)
   ------------------------- */
let mode = "in"; // "in" = login, "up" = signup
const switcher = document.getElementById("switcher");
const modeBtn = document.getElementById("modeBtn");
const modeText = document.getElementById("mode_text");
const loginForm = document.getElementById("login_form");
const signupForm = document.getElementById("signup_form");
const authTitle = document.getElementById("auth_title");

function updateModeUI(){
  // visual text on button
  modeText.textContent = (mode === "in") ? "IN" : "UP";
  // show appropriate form
  if(mode === "in"){
    loginForm.style.display = "";
    signupForm.style.display = "none";
    authTitle.textContent = "Accedi al tuo account";
  } else {
    loginForm.style.display = "none";
    signupForm.style.display = "";
    authTitle.textContent = "Crea un nuovo account";
  }
  // ensure switcher visual matches mode
  if(mode === "up") switcher.classList.add("switch");
  else switcher.classList.remove("switch");
}
modeBtn.addEventListener("click", () => {
  // animate and toggle mode
  mode = (mode === "in") ? "up" : "in";
  // toggle visual transform
  switcher.classList.toggle("switch");
  // small delay to let animation run then update forms
  setTimeout(updateModeUI, 160);
});

/* helper to programmatically switch */
function switchTo(target){
  mode = (target === "signup") ? "up" : "in";
  updateModeUI();
}

/* -------------------------
   Auth actions
   ------------------------- */
function doSignup(){
  const u = document.getElementById("signup_user").value.trim();
  const p = document.getElementById("signup_pass").value;
  if(!u || !p){ alert("Compila username e password"); return; }
  if(state.users[u]){ alert("Username gi√† esistente"); return; }
  state.users[u] = { password: p, role: "user", profile: { desc: "", avatar: "" } };
  state.currentUser = u;
  saveState();
  enterApp();
}

function doLogin(){
  const u = document.getElementById("login_user").value.trim();
  const p = document.getElementById("login_pass").value;
  const user = state.users[u];
  if(!user || user.password !== p){ shakeAuth(); alert("Credenziali errate"); return; }
  state.currentUser = u;
  saveState();
  enterApp();
}

function guestLogin(){
  const name = "guest_" + Math.floor(Date.now()/1000);
  state.users[name] = { password: "", role: "guest", profile: { desc: "", avatar: "" } };
  state.currentUser = name;
  saveState();
  enterApp();
}

/* small shake animation on auth card when error */
function shakeAuth(){
  const el = document.getElementById("auth_view");
  el.style.transition = "transform .08s ease";
  el.style.transform = "translateX(-8px)";
  setTimeout(()=>el.style.transform = "translateX(8px)", 80);
  setTimeout(()=>el.style.transform = "translateX(0)", 160);
  setTimeout(()=>el.style.transition = "", 260);
}

/* -------------------------
   Enter / Exit app
   ------------------------- */
function enterApp(){
  // hide auth, hide switch, show app
  document.getElementById("auth_view").style.display = "none";
  document.getElementById("switcher").style.display = "none";
  document.getElementById("modeBtn").style.display = "none";
  document.getElementById("app").style.display = "block";
  // render content
  renderAll();
  // ensure home tab active
  activateNav('nav_home');
  switchTab('home', document.getElementById('nav_home'));
}

function doLogout(){
  state.currentUser = null;
  saveState();
  // show auth again and reset switch visibility
  document.getElementById("auth_view").style.display = "";
  document.getElementById("switcher").style.display = "";
  document.getElementById("modeBtn").style.display = "";
  // reset UI
  switcher.classList.remove("switch");
  mode = "in";
  updateModeUI();
  document.getElementById("app").style.display = "none";
}

/* -------------------------
   Tabs
   ------------------------- */
function switchTab(name, el){
  // nav active
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  if(el) el.classList.add('active');
  // tabs
  document.querySelectorAll('.tab').forEach(t=>{ t.classList.remove('active'); t.style.display='none'; });
  const tab = document.getElementById('tab_' + name);
  if(!tab) return;
  tab.style.display = 'block';
  // small timeout to trigger CSS transition
  setTimeout(()=>tab.classList.add('active'), 10);
}
function activateNav(id){ document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active')); const el=document.getElementById(id); if(el) el.classList.add('active'); }

/* -------------------------
   Profile
   ------------------------- */
function renderProfile(){
  const u = state.currentUser;
  if(!u) return;
  const user = state.users[u];
  document.getElementById('profile_name').textContent = u;
  document.getElementById('profile_desc_input').value = user.profile.desc || "";
  document.getElementById('profile_avatar_url').value = user.profile.avatar || "";
}
function saveProfile(){
  const u = state.currentUser;
  if(!u) return;
  const user = state.users[u];
  user.profile.desc = document.getElementById('profile_desc_input').value.trim();
  const url = document.getElementById('profile_avatar_url').value.trim();
  if(url) user.profile.avatar = url;
  const file = document.getElementById('profile_avatar_file').files[0];
  if(file){
    const r = new FileReader();
    r.onload = e => { user.profile.avatar = e.target.result; saveState(); renderProfile(); };
    r.readAsDataURL(file);
  } else {
    saveState();
    renderProfile();
  }
}

/* -------------------------
   Posts
   ------------------------- */
function createPost(){
  const u = state.currentUser;
  if(!u) return alert("Devi essere loggato");
  if(state.users[u].role === "guest") return alert("Guest non pu√≤ creare post");
  const text = document.getElementById('post_text').value.trim();
  let media = document.getElementById('post_media_url').value.trim();
  const file = document.getElementById('post_media_file').files[0];
  if(file){
    const r = new FileReader();
    r.onload = e => { media = e.target.result; pushPost(text, media); };
    r.readAsDataURL(file);
  } else {
    pushPost(text, media);
  }
}
function pushPost(text, media){
  if(!text && !media) return alert("Post vuoto");
  const post = { id: Date.now(), author: state.currentUser, text, media, likes: [], comments: [] };
  state.posts.push(post);
  saveState();
  document.getElementById('post_text').value = '';
  document.getElementById('post_media_url').value = '';
  document.getElementById('post_media_file').value = '';
  renderFeed();
  renderMyPosts();
}

/* comment */
function addComment(postId){
  const input = document.getElementById('cmt_' + postId);
  if(!input) return;
  const text = input.value.trim();
  if(!text) return;
  const post = state.posts.find(p=>p.id===postId);
  if(!post) return;
  post.comments.push({ id: Date.now(), author: state.currentUser, text });
  saveState();
  renderFeed();
}

/* like */
function toggleLike(postId){
  const user = state.currentUser;
  if(!user) return;
  const post = state.posts.find(p=>p.id===postId);
  if(!post) return;
  const idx = post.likes.indexOf(user);
  if(idx >= 0) post.likes.splice(idx,1); else post.likes.push(user);
  saveState();
  renderFeed();
}

/* share (copy link with hash) */
function sharePost(postId){
  const url = location.origin + location.pathname + '#post-' + postId;
  navigator.clipboard?.writeText(url).then(()=>alert('Link copiato negli appunti'));
}

/* -------------------------
   Renderers
   ------------------------- */
function renderFeed(){
  const feed = document.getElementById('feed');
  feed.innerHTML = '';
  // newest first
  [...state.posts].sort((a,b)=>b.id-a.id).forEach(p=>{
    const div = document.createElement('div');
    div.className = 'post';
    const mediaHtml = p.media ? (p.media.startsWith('data:') || p.media.includes('http') ? (p.media.includes('video') ? `<div class="post-media"><video src="${p.media}" controls></video></div>` : `<div class="post-media"><img src="${p.media}" alt="media"></div>`) : '') : '';
    const likes = p.likes.length;
    const commentsHtml = (p.comments || []).map(c=>`<div class="comment"><strong>@${c.author}</strong><div>${escapeHtml(c.text)}</div></div>`).join('');
    div.innerHTML = `
      <div class="meta"><strong>@${p.author}</strong> <span style="color:var(--muted)">‚Ä¢ ${new Date(p.id).toLocaleString()}</span></div>
      <div style="margin-top:6px">${escapeHtml(p.text)}</div>
      ${mediaHtml}
      <div class="controls">
        <button class="like" onclick="toggleLike(${p.id})">‚ù§Ô∏è ${likes}</button>
        <button class="share" onclick="sharePost(${p.id})">üîó Share</button>
      </div>
      <div style="margin-top:8px">
        <textarea id="cmt_${p.id}" rows="1" placeholder="Commenta..." style="width:70%;display:inline-block"></textarea>
        <button class="btn" onclick="addComment(${p.id})" style="display:inline-block">Invia</button>
      </div>
      <div style="margin-top:8px">${commentsHtml}</div>
    `;
    feed.appendChild(div);
  });
}

function renderMyPosts(){
  const container = document.getElementById('my_posts');
  container.innerHTML = '';
  state.posts.filter(p=>p.author === state.currentUser).sort((a,b)=>b.id-a.id).forEach(p=>{
    const el = document.createElement('div');
    el.className = 'post';
    el.innerHTML = `<div class="meta"><strong>@${p.author}</strong> ‚Ä¢ ${new Date(p.id).toLocaleString()}</div><div style="margin-top:6px">${escapeHtml(p.text)}</div>`;
    container.appendChild(el);
  });
}

function renderProfile(){
  const nameEl = document.getElementById('profile_name');
  const user = state.users[state.currentUser];
  nameEl.textContent = state.currentUser;
  // show avatar if present (simple)
  if(user && user.profile && user.profile.avatar){
    nameEl.innerHTML = `<img src="${user.profile.avatar}" alt="avatar" style="width:36px;height:36px;border-radius:50%;vertical-align:middle;margin-right:8px"> <strong>${escapeHtml(state.currentUser)}</strong>`;
  }
}

/* render all */
function renderAll(){
  renderProfile();
  renderFeed();
  renderMyPosts();
}

/* -------------------------
   Utilities
   ------------------------- */
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

function applyTheme(v){
  if(v === 'light'){
    document.documentElement.style.setProperty('--card','#f7f9fc');
    document.documentElement.style.setProperty('--bg','#f0f4f8');
    document.documentElement.style.setProperty('--muted','#334155');
    document.documentElement.style.setProperty('--accent','#0b6ef6');
    document.documentElement.style.setProperty('--accent-2','#d6336c');
    document.documentElement.style.setProperty('--glass','rgba(0,0,0,0.04)');
    document.body.style.color = '#071021';
  } else {
    // reset to dark
    document.documentElement.style.removeProperty('--card');
    document.documentElement.style.removeProperty('--bg');
    document.documentElement.style.removeProperty('--muted');
    document.documentElement.style.removeProperty('--accent');
    document.documentElement.style.removeProperty('--accent-2');
    document.documentElement.style.removeProperty('--glass');
    document.body.style.color = '';
  }
}

/* -------------------------
   Initial UI state
   ------------------------- */
updateModeUI();
if(state.currentUser){
  // if already logged in, show app directly
  enterApp();
} else {
  // show auth view
  document.getElementById('auth_view').style.display = '';
  document.getElementById('app').style.display = 'none';
}

/* expose some functions for inline handlers */
window.toggleMode = () => { modeBtn.click(); };
window.doLogin = doLogin;
window.doSignup = doSignup;
window.guestLogin = guestLogin;
window.switchTo = switchTo;
window.createPost = createPost;
window.renderMyPosts = renderMyPosts;
window.saveProfile = saveProfile;
window.renderProfile = renderProfile;
window.switchTab = switchTab;
window.doLogout = doLogout;
window.applyTheme = applyTheme;
window.toggleSwitch = () => modeBtn.click();

/* save periodically */
setInterval(saveState, 3000);
</script>
</body>
</html>
